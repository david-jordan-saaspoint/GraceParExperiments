<head>
<h1>Choice of Records from Rest Sc4 </h1>
<h2> Click to choose records </h2>
<% form_tag  :controller => 'worksiteblock', :action => 'get_user_req' do %>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>
<script src="/javascripts/selectall.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<table>
  <tr>
  	<% j =0 %>
    <th>Accounts</th>
    <th>Name</th>
    <th>Company Number</th>
    <th>Par ID</th>
    <th> All Accounts<%= check_box_tag 'accountsall' , 'toggle', false, :onclick => "toggleAll('accountselect');return true;" %></th>  
  </tr>
  
  <% i =0 %>
  <% @mapped_data.each do |acc| %>
  	<% i= i+1 %>
  	<tr>
  		<% checked = false %>      
  		<td><%= i  %></td>
    	<td><%= acc["Name"]  %></td>
    	<td><%= acc["CompanyNumber"]  %></td>
    	<% if session[:account_selected].blank? %> 
    		<% checked = false %>
    	<% elsif (session[:account_selected].include?("#{acc['parId']}")) %>
    		<% checked = true %>
    	<% end %>
    	<td> <%=acc["parId"] %> </td>
    	<td> <%= hidden_field_tag "accountPar" , "#{acc['parId']}" %> </td>
    	<td> <%= check_box_tag  "par_idset[#{i}]" , "#{acc['parId']}", checked, :id=>"par_idset_#{i}", :class => 'accountselect' %>   </td>
    	<td><%= submit_tag "Show Contacts"  + " " + "#{acc['parId']}" %></td>
    </tr>
  	<% this_acc_par_id = acc["parId"] %>
  	<% if  (params[:par] == "#{acc['parId']}")  or (@contacts_hash[this_acc_par_id].blank? == false) %>
  		<tr>
  			<th></th>
    		<th>Contacts</th>
    		<th>First Name</th>
    		<th>Last Name</th>
    		<th>Status</th>
    		<th>Subscribed</th>
    		<th>Par ID</th>
    		<th> All<%= check_box_tag 'contactsall' , 'toggle', false, :onclick => "toggleAll('contactselect');return true;" %></th>
    		
  		</tr>
  		
  		<% @contacts_hash[this_acc_par_id].each do |arr| %>
  		 <% j= j+1 %>
  		 <tr>
  			<td>     </td>
  			<td>Contact <%= j  %></td>
  			<td><%= arr["FirstName"]  %></td>
    		<td><%= arr["LastName"]  %></td>
    		<td><%= arr["Status"]  %></td>
    		<td><%= arr["Subscribed"]  %></td>
    		<td> <%=arr["parId"] %> </td>
    		<% session[:accountPar] = "#{acc['parId']}" %>
    		<% checked = false %>
    		<% if session[:contact_selected][this_acc_par_id].blank? %> 
    			<% checked = false %>
    		<% elsif (session[:contact_selected][this_acc_par_id].include?("#{arr['parId']}")) %>
     			<% checked = true %>
    		<% end %>
    		
    		<% if "#{arr['parId']}".blank? == false %>
    		<% value = "#{arr['parId']}" + "-" + "#{acc['parId']}"  %>
    		<td><%= check_box_tag  "par_contactset[#{j}]" , value, checked, :id=>"par_contactset_#{j}", :class => 'contactselect' %>   </td>
    		<% end %>
  		</tr>
  		<% end %> 
 	<% end %>  
  <% end %>
</table>
<%= submit_tag "Submit" %>
<% end %>
</body>
   



 

